#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>
#include <OneWire.h>
#include <DallasTemperature.h>

#define SCREEN_WIDTH 128  // OLED width, in pixels
#define SCREEN_HEIGHT 64  // OLED height, in pixels
#define ONE_WIRE_BUS 23   // Pino de dados do sensor DS18B20

// Criando o objeto do display OLED
Adafruit_SSD1306 oled(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, -1);

// Configurando o sensor de temperatura DS18B20
OneWire oneWire(ONE_WIRE_BUS);
DallasTemperature sensors(&oneWire);

void setup() {
  Serial.begin(115200);

  // Inicializando o display OLED com o endereço I2C 0x3C
  if (!oled.begin(SSD1306_SWITCHCAPVCC, 0x3C)) {
    Serial.println(F("Falha ao iniciar o SSD1306 OLED"));
    while (1); // Se falhar, fica preso aqui
  }

  // Inicializando o sensor de temperatura
  sensors.begin();

  // Pausa de 2 segundos para o OLED inicializar
  delay(2000);
  
  // Limpando o display antes de começar
  oled.clearDisplay();
  oled.display();

  // Configura o texto e o estilo do OLED
  oled.setTextSize(2);        // Tamanho da letra
  oled.setTextColor(SSD1306_WHITE);  // Cor do texto
}

void loop() {
  // Solicita a temperatura do sensor
  sensors.requestTemperatures();
  float temperature = sensors.getTempCByIndex(0);  // Obtém a temperatura em graus Celsius

  // Limpa a tela do OLED
  oled.clearDisplay();

  // Centraliza a temperatura no OLED
  oled.setCursor((SCREEN_WIDTH - 48) / 2, SCREEN_HEIGHT / 4); // Ajuste para centralizar
  oled.print("Temp: ");
  oled.print(temperature, 1);  // Imprime a temperatura com 1 casa decimal
  oled.print(" C");

  // Exibe a temperatura no display
  oled.display();

  // Imprime a temperatura no Serial Monitor
  Serial.print("Temperatura: ");
  Serial.print(temperature, 1);  // Imprime a temperatura com 1 casa decimal
  Serial.println(" C");

  delay(1000); // Aguarda 1 segundo antes de ler novamente
}
